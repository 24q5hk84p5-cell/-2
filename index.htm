<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>×‘× ×§ ×”×›×™×ª×” - ××¦×‘ ×ª×¦×•×’×” ×•×¢×¨×™×›×”</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #3498db; --success: #2ecc71; --danger: #e74c3c; --warning: #f39c12; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f4f8; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 800px; }
        
        /* × ×™×”×•×œ ××¦×‘×™× */
        .mode-toggle { margin-bottom: 20px; }
        .edit-mode, .display-mode { display: none; }
        .active { display: block; }

        /* ×¤×•×“×™×•× */
        .podium { display: flex; justify-content: center; align-items: flex-end; gap: 15px; margin-bottom: 30px; padding: 20px; background: #fff; border-bottom: 2px solid #eee; }
        .podium-place { display: flex; flex-direction: column; align-items: center; text-align: center; }
        .podium-bar { width: 80px; border-radius: 10px 10px 0 0; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; font-weight: bold; }
        .first { height: 120px; background: #ffd700; order: 2; font-size: 1.5em; }
        .second { height: 90px; background: #c0c0c0; order: 1; }
        .third { height: 70px; background: #cd7f32; order: 3; }
        .podium-name { font-size: 0.9em; font-weight: bold; margin-bottom: 5px; width: 90px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* ×¨×©×™××ª ×ª×œ××™×“×™× */
        .student-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; }
        .student-name { font-size: 1.2em; font-weight: 600; flex-grow: 1; }
        .balance { font-size: 1.4em; font-weight: bold; margin: 0 20px; min-width: 80px; text-align: center; }
        .positive { color: var(--success); }
        .negative { color: var(--danger); }

        /* ×›×¤×ª×•×¨×™× */
        .btn { border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; margin: 0 2px; }
        .btn-mode { background: #2c3e50; color: white; padding: 12px 25px; font-size: 1em; }
        .btn-plus { background: var(--success); color: white; }
        .btn-minus { background: var(--danger); color: white; }
        .btn-info { background: #9b59b6; color: white; font-size: 0.8em; }
        
        /* ×”×™×¡×˜×•×¨×™×”/×¡×™×‘×•×ª */
        .history-list { font-size: 0.85em; color: #666; margin-top: 5px; display: none; background: #f9f9f9; padding: 10px; border-radius: 5px; }
        
        .toolbar { background: #f8f9fa; padding: 20px; border-radius: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    </style>
</head>
<body>

    <div class="mode-toggle">
        <button class="btn btn-mode" onclick="toggleMode()">ğŸ”„ ×”×—×œ×£ ×œ××¦×‘ ×¢×¨×™×›×” / ×ª×¦×•×’×”</button>
    </div>

    <div class="container">
        <div id="displaySection" class="display-mode active">
            <h1 style="text-align:center;">ğŸ† ×œ×•×— ×”× ×™×§×•×“ ×”×›×™×ª×ª×™</h1>
            <div id="podium" class="podium"></div>
            <div id="studentListDisplay"></div>
        </div>

        <div id="editSection" class="edit-mode">
            <h1>âš™ï¸ × ×™×”×•×œ × ×ª×•× ×™ ×‘× ×§</h1>
            <div class="toolbar">
                <div>
                    <h3>×˜×¢×™× ×ª × ×ª×•× ×™×</h3>
                    <button class="btn" style="background:var(--primary); color:white;" onclick="document.getElementById('excelInput').click()">ğŸ“Š ×˜×¢×Ÿ ××§×¡×œ (.xlsx)</button>
                    <input type="file" id="excelInput" style="display:none" accept=".xlsx, .xls" onchange="importExcel(event)">
                </div>
                <div>
                    <h3>×¤×¢×•×œ×•×ª ××¢×¨×›×ª</h3>
                    <button class="btn" style="background:var(--warning); color:white;" onclick="resetAll()">ğŸ”„ ××™×¤×•×¡ ×œ-100</button>
                    <button class="btn" style="background:#7f8c8d; color:white;" onclick="exportData()">ğŸ’¾ ×’×™×‘×•×™ ×™×“× ×™</button>
                </div>
            </div>
            <div id="studentListEdit" style="margin-top:20px;"></div>
        </div>
    </div>

<script>
    const initialNames = ["××‘×¨××•×‘×™×¥ ×“× ×™××œ", "××™×•×‘ ××™×ª×Ÿ", "××œ×’×¨×‘×œ×™ ×‘× ×™×” ×¢×•×–", "××œ××• × ×ª× ××œ", "××¨×‘×œ ××œ×™×” ××”×¨×•×Ÿ", "×‘×œ×•×¡×˜×•×¦×§×™ ×”×œ×œ ×™×©×™", "×‘×Ÿ ×¢×˜×¨ × ×ª××™ ×™×•×¡×£", "×‘×Ÿ ×¤×•×¨×ª × ×¢×", "×’×•×¨×“×•×Ÿ ×‘× ×™×”", "×’×œ×™×™×–×¨ ×©×œ×•×", "×“×”×Ÿ ×™×•×¡×£ ×—×™×™×", "×”×™×¨×©× ×‘×¨×’×¨ ×‘×•×¢×–", "×•×•×™×¡××Ÿ ×™×”×•× ×ª×Ÿ", "×•×œ×¨ × ×•×•×” ××”×¨×Ÿ", "×˜×× ×” ××‘×™×”×•", "×™×•×©×¢×™ × ×¢×", "×™×¢×§×‘×™ ×™×”×•×“×”", "×›×”×Ÿ ×œ×™××•×¨", "×›×”×Ÿ × ×™×ª××™", "×× ×¦×•×¨ ×”×¨××œ", "××¨×¡×™×× ×• ××•×¨×™", "× ×“×œ × ×•×”", "× ×™××–×•×‘ ××‘×™××œ", "×¡×× ×™ ×©×‘×—", "×¤×•×¨×¡×˜ ×¢××™×—×™", "×¤×œ×•××‘×• × ×¨×™×”", "×¤× ×§×¨ ×©×™×œ×”", "×¤×¨×©×œ ××œ××›×™", "×§×¦×‘ × ×¢×", "×¨×•×–× ×¦×•×•×™×’ ×‘×¢×– ××©×¨"];

    // ×˜×¢×™× ×ª × ×ª×•× ×™× ×›×•×œ×œ ×”×™×¡×˜×•×¨×™×”
    let state = JSON.parse(localStorage.getItem('class_bank_final')) || {
        students: initialNames.map(name => ({ name, points: 100, history: [] })),
        isEditMode: false
    };

    function render() {
        const sorted = [...state.students].sort((a, b) => b.points - a.points);
        
        // ×¨×™× ×“×•×¨ ×¤×•×“×™×•×
        document.getElementById('podium').innerHTML = `
            <div class="podium-place"><div class="podium-name">${sorted[1]?.name}</div><div class="podium-bar second"><span>${sorted[1]?.points}</span></div></div>
            <div class="podium-place"><div class="podium-name">${sorted[0]?.name}</div><div class="podium-bar first"><span>${sorted[0]?.points}</span></div></div>
            <div class="podium-place"><div class="podium-name">${sorted[2]?.name}</div><div class="podium-bar third"><span>${sorted[2]?.points}</span></div></div>
        `;

        // ×¨×™× ×“×•×¨ ×¨×©×™××ª ×ª×¦×•×’×”
        const displayList = document.getElementById('studentListDisplay');
        displayList.innerHTML = '';
        [...state.students].sort((a,b) => a.name.localeCompare(b.name)).forEach((s, i) => {
            const originalIndex = state.students.findIndex(st => st.name === s.name);
            displayList.innerHTML += `
                <div class="student-item">
                    <div class="student-name">${s.name}</div>
                    <button class="btn btn-info" onclick="toggleHistory(${originalIndex})">ğŸ“‹ ×¡×™×‘×•×ª</button>
                    <span class="balance ${s.points < 100 ? 'negative' : 'positive'}">${s.points} â‚ª</span>
                    <div class="controls">
                        <button class="btn btn-plus" onclick="updatePoints(${originalIndex}, 5)">+5</button>
                        <button class="btn btn-minus" onclick="updatePoints(${originalIndex}, -5)">-5</button>
                    </div>
                    <div id="hist-${originalIndex}" class="history-list">
                        ${s.history.length ? s.history.map(h => `â€¢ ${h}`).join('<br>') : '××™×Ÿ ×”×™×¡×˜×•×¨×™×” ×¨×©×•××”'}
                    </div>
                </div>
            `;
        });

        localStorage.setItem('class_bank_final', JSON.stringify(state));
    }

    function toggleMode() {
        state.isEditMode = !state.isEditMode;
        document.getElementById('displaySection').classList.toggle('active', !state.isEditMode);
        document.getElementById('editSection').classList.toggle('active', state.isEditMode);
        render();
    }

    function updatePoints(index, amount, reason = "×¢×“×›×•×Ÿ ×™×“× ×™") {
        state.students[index].points += amount;
        const date = new Date().toLocaleDateString('he-IL');
        state.students[index].history.unshift(`${date}: ${amount > 0 ? '+' : ''}${amount} (${reason})`);
        render();
    }

    function toggleHistory(index) {
        const el = document.getElementById(`hist-${index}`);
        el.style.display = el.style.display === 'block' ? 'none' : 'block';
    }

    function importExcel(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (event) => {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const rows = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], {header: 1});

            rows.forEach(row => {
                const name = row[0]?.toString().trim();
                const value = parseInt(row[1]);
                const reason = row[2] || "×¢×“×›×•×Ÿ ×××§×¡×œ";
                
                if (name && !isNaN(value)) {
                    const idx = state.students.findIndex(s => s.name === name);
                    if (idx !== -1) {
                        state.students[idx].points += value;
                        state.students[idx].history.unshift(`${new Date().toLocaleDateString('he-IL')}: ${value > 0 ? '+' : ''}${value} (${reason})`);
                    }
                }
            });
            alert("×”× ×ª×•× ×™× ×¢×•×“×›× ×•!");
            render();
        };
        reader.readAsArrayBuffer(file);
    }

    function resetAll() {
        if(confirm("×œ××¤×¡ ××ª ×›×•×œ× ×œ-100 ×•×œ××—×•×§ ×”×™×¡×˜×•×¨×™×”?")) {
            state.students.forEach(s => { s.points = 100; s.history = []; });
            render();
        }
    }

    render();
</script>
</body>
</html>
